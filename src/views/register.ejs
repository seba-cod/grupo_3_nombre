<!DOCTYPE html>
<html lang="en">
<%- include('./partials/head') %>
  <body>
    <%- include('./partials/header') %>
      <div class="container-form  log-reg">
        <div class="row">

          <form action="/user/register" METHOD="POST" class="publish" id="regform" enctype="multipart/form-data">
            <h5>Registración</h5>

            <div id="user_name" class="col-1">

              <label for="user_name">Nombre de Usuario</label>
              <div>
                <input type="text" class="txt_input" name="user_name" id="user_name" <% if (locals.old && old.user_name) { %> value="<%=  old.user_name %>" <% } %>>
              </div>

              <% if (locals.errors && errors.user_name) { %>
                <div class="text-danger">
                  <%= errors.user_name.msg %>
                </div>
              <% } %>

              <div id='toScriptOnUsername' class='text-danger'>
                <h6></h6>
              </div>

            </div>

            <div id="first_name" class="col-1">

              <label for="first_name">Nombre/s</label>
              <div>
                <input type="text" class="txt_input" name="first_name" id="first_name" <% if (locals.old && old.first_name) { %> value="<%=  old.first_name %>" <% } %>>
              </div>

              <% if (locals.errors && errors.first_name) { %>
                <div class="text-danger">
                  <%= errors.first_name.msg %>
                </div>
              <% } %>

              <div id='toScriptOnFirstName' class='text-danger'>
                <h6></h6>
              </div>

            </div>

            <div id="last_name" class="col-1">

              <label for="last_name">Apellido/s</label>
              <div>
                <input type="text" class="txt_input" name="last_name" id="last_name" <% if (locals.old && old.last_name) { %> value="<%=  old.last_name %>" <% } %>>
              </div>

              <% if (locals.errors && errors.last_name) { %>
                <div class="text-danger">
                  <%= errors.last_name.msg %>
                </div>
              <% } %>

              <div id='toScriptOnLastName' class='text-danger'>
                <h6></h6>
              </div>
            </div>

            <div id="email" class="col-1">

              <label for="correo">Correo Electrónico</label>
                <input type="email" class="txt_input" name="email" id="email" placeholder="ejemplo@email.com" <% if (locals.old && old.email) { %> value="<%=  old.email %>" <% } %> >
                
                <% if (locals.errors && errors.email) { %>
                  <div class="text-danger">
                    <%= errors.email.msg %>
                  </div>
                <% } %>

                <div id='toScriptOnEmail' class='text-danger'>
                  <h6></h6>
                </div>

            </div>

            <div id="address" class="col-1">

              <label for="address">Dirección</label>
              <div class="container_input">
                <input type="text" class="txt_input" name="address" id="address" placeholder="Calle # - CP - Localidad" <% if (locals.old && old.address) { %> value="<%=  old.address %>" <% } %>>
              </div>

              <% if (locals.errors && errors.address) { %>
                <div class="text-danger">
                  <%= errors.address.msg %>
                </div>
              <% } %>

              <div id='toScriptOnAddress' class='text-danger'>
                <h6></h6>
              </div>

            </div>

            <div id="password" class="col-1">

              <label for="password">Contraseña</label>
              <div class="container_input">
                <input type="password" class="txt_input" name="password" id="password">
              </div>

              <% if (locals.errors && errors.password) { %>
                <div class="text-danger">
                  <%= errors.password.msg %>
                </div>
              <% } %>

                <div id='toScriptOnPassword' class='text-danger'>
                  <h6></h6>
                </div>

              </div>

            <div id="avatar" class="col-1">

              <label for="profile">Avatar </label>
              <input type="file" name="avatar" id="avatar">

              <% if (locals.errors && errors.avatar) { %>
                <div class="text-danger">
                  <%= errors.avatar.msg %>
                </div>
              <% } %>

              <div id='toScriptOnAvatar' class='text-danger'>
                <h6></h6>
              </div>

            </div>

            <div id="terms" class="col-1 terms">

              <label>Acepto los Términos y Condiciones

                <input class="check-form" type="checkbox" name="terms" id="terms"></label>

            <div id='toScriptCheckbox' class='text-danger'>
              <h6></h6>
            </div>

            </div>

            <input type="submit" class="ok-input" value="Registrate" id="submit">
          </form>
        </div>
      </div>
      <%- include('./partials/footer') %>

      <script>
        const dangerColor = 'rgba(255,0,0,0.2)';
        const succesColor = 'rgba(0,255,0,0.2)';

        function resetErrors(messageElement, input){
            if (messageElement){
            messageElement.innerHTML = '';
            }
            if (input){
            input.style.background = 'rgba(255,0,0,0)'
            }
        }

        const usernameInput = document.querySelector('input#user_name')
        const FirstNameInput = document.querySelector('input#first_name')
        const LastNameInput = document.querySelector('input#last_name')
        const emailInput = document.querySelector('input#email')
        const addressInput = document.querySelector('input#address')
        const passwordInput = document.querySelector('input#password')
        const avatar = document.querySelector('input#avatar')
        const terms = document.querySelector('input#terms')
        const submitButton = document.querySelector('input#submit')
        const form = document.querySelector('#regform')

        const toScriptOnUsername = document.querySelector('#toScriptOnUsername')
        const toScriptOnFirstName = document.querySelector('#toScriptOnFirstName')
        const toScriptOnLastName = document.querySelector('#toScriptOnLastName')
        const toScriptOnEmail = document.querySelector('#toScriptOnEmail')
        const toScriptOnPassword = document.querySelector('#toScriptOnPassword')
        const toScriptOnAddress = document.querySelector('#toScriptOnAddress')
        const toScriptOnAvatar = document.querySelector('#toScriptOnAvatar')
        const toScriptCheckbox = document.querySelector('#toScriptCheckbox')
            
        usernameInput.addEventListener('keyup', (e) => {
          const username = e.target.value;
          if (username.length < 4 ) {
            usernameInput.style.background = dangerColor
            toScriptOnUsername.innerHTML = 'Escribe tu nombre de usuario, cuatro letras minimo'
          }
          if (username.length >= 4) {
            resetErrors(toScriptOnUsername, usernameInput)
            return usernameInput.style.background = succesColor
          }
        })
        
        FirstNameInput.addEventListener('keyup', (e) => {
          const firstname = e.target.value;

          if (firstname.length < 2 ) {
            FirstNameInput.style.background = dangerColor
            toScriptOnFirstName.innerHTML = 'Escribe tu nombre'
          }
          if (firstname.length >= 2) {
            resetErrors(toScriptOnFirstName, FirstNameInput)
            return FirstNameInput.style.background = succesColor
          }
        })

        LastNameInput.addEventListener('keyup', (e) => {
          const lastname = e.target.value;

          if (lastname.length < 2 ) {
            LastNameInput.style.background = dangerColor
            toScriptOnLastName.innerHTML = 'Escribe tu apellido'
          }
          if (lastname.length >= 2) {
            resetErrors(toScriptOnLastName, LastNameInput)
            return LastNameInput.style.background = succesColor
          }
        })
      
        emailInput.addEventListener('keyup', (e) => {
            email = e.target.value;
            // Veo si lo que escribió es mayor a 3 caracteres
            if (email.length < 3) {
                emailInput.style.background = dangerColor
                toScriptOnEmail.innerHTML = 'Escribe un mail válido. Tu email debería contener un arroba. Ejemplo: myEmail@fake.com'
            } 

            const emailSplitByAt = email.split('@')
            // Pregunto si mi array divido por el arroba tiene más de una posición 
            if (emailSplitByAt.length > 0){
                //Busco un punto en su segunda posición
                let stringAfterAt = emailSplitByAt[1].split('.')
                if (stringAfterAt[1].length>0) {
                resetErrors(toScriptOnEmail, emailInput)
                return emailInput.style.background = succesColor
                }
            }
        })

        addressInput.addEventListener('keyup', (e) => {
          const address = e.target.value;

          if (address.length <= 4 ) {
            addressInput.style.background = dangerColor
            toScriptOnAddress.innerHTML = 'Escribe tu dirección real'
          }
          if (address.length > 4) {
            resetErrors(toScriptOnAddress, addressInput)
            return addressInput.style.background = succesColor
          }
        })

       passwordInput.addEventListener('keyup', (e) => {
              password = e.target.value;
              if (password.length < 6){
              passwordInput.style.background = dangerColor
              toScriptOnPassword.innerHTML = 'Escribe al menos 6 caracteres'
              }
              if (password.length >= 6){
              resetErrors(toScriptOnPassword, passwordInput)
              return passwordInput.style.background = succesColor
              }
        } );

        avatar.addEventListener('change', (e) => {
          if (avatar.value) {
            resetErrors(toScriptOnAvatar, false)
          }
        })
        terms.addEventListener('change', (e) => {
          if (terms.checked ) {
            resetErrors(toScriptCheckbox, false)
          }
        })

        regform.addEventListener('submit', (e) => {
          if (usernameInput.value.length < 4 ) {
            e.preventDefault()
            usernameInput.style.background = dangerColor
            toScriptOnUsername.innerHTML = 'Escribe tu nombre de usuario, cuatro letras minimo'
          }
          if (FirstNameInput.value.length < 2 ) {
            e.preventDefault()
            FirstNameInput.style.background = dangerColor
            toScriptOnFirstName.innerHTML = 'Escribe tu nombre'
          }
          if (LastNameInput.value.length < 2 ) {
            e.preventDefault()
            LastNameInput.style.background = dangerColor
            toScriptOnLastName.innerHTML = 'Escribe tu apellido'
          }
          if (emailInput.value.length < 3) {
            e.preventDefault()
              emailInput.style.background = dangerColor
              toScriptOnEmail.innerHTML = 'Escribe un mail válido. Tu email debería contener un arroba. Ejemplo: myEmail@fake.com'
            } 
          if (addressInput.value.length <= 4 ) {
            e.preventDefault()
            addressInput.style.background = dangerColor
            toScriptOnAddress.innerHTML = 'Escribe tu dirección real'
          }
          if (passwordInput.value.length < 6){
            e.preventDefault()
            passwordInput.style.background = dangerColor
            toScriptOnPassword.innerHTML = 'Escribe al menos 6 caracteres'
          }
          if (!terms.checked ) {
            e.preventDefault()
            toScriptCheckbox.innerHTML = 'No puedes dejar este campo vacío'
            terms.style.background = dangerColor
          }
          if (!avatar.value) {
            e.preventDefault()
            toScriptOnAvatar.innerHTML = 'Sube una imagen'
          }
        })
    
      </script>
  </body>

</html>